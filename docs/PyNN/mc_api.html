<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="./" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Multicompartmental modelling | PyNN 0.12.3 documentation</title>
<meta content="Multicompartmental modelling | PyNN 0.12.3 documentation" property="og:title"/>
<meta content="Multicompartmental modelling | PyNN 0.12.3 documentation" name="twitter:title"/>
<link href="_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="_static/theme.css?v=42baaae4" rel="stylesheet" type="text/css"/>
<link href="_static/custom.css?v=14d0ad6c" rel="stylesheet" type="text/css"/>
<link href="_static/pyNN_icon.ico" rel="icon"/>
<link href="search.html" rel="search" title="Search"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="injecting_current.html" rel="next" title="Injecting current"/>
<link href="space.html" rel="prev" title="Representing spatial structure and calculating distances"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="index.html">
<img alt="Logo" class="mr-2 dark:invert" height="24" src="_static/pyNN_logo.png" width="24"/><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">PyNN 0.12.3 documentation</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="index.html">
<img alt="Logo" class="mr-2 dark:invert" height="16" src="_static/pyNN_logo.png" width="16"/><span class="font-bold text-clip whitespace-nowrap">PyNN 0.12.3 documentation</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="building_networks.html">Building networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="injecting_current.html">Injecting current</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording spikes and state variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_handling.html">Data handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation_control.html">Simulation control</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Model parameters and initial values</a></li>
<li class="toctree-l1"><a class="reference internal" href="random_numbers.html">Random numbers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Multicompartmental modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel.html">Running parallel simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="import_export.html">Importing from and exporting to other formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications about, relating to or using PyNN</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributors, licence and funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release notes</a></li>
</ul>
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="developers_guide.html">Developers’ guide<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="developers/bug_reports.html">Bug reports and feature requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers/contributing.html">Contributing to PyNN</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers/governance.html">Governance</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="api_reference.html">API reference<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="reference/populations.html">Populations, Views and Assemblies</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/connectors.html">Connectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/projections.html">Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/neuronmodels.html">Neuron models</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/plasticitymodels.html">Synapse models</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/electrodes.html">Current sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/simulationcontrol.html">Simulation control</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/random.html">Random numbers</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/parameters.html">Parameter handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/space.html">Spatial structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/utility.html">Utility classes and functions</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="standardmodels.html">Standard models</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="index.html">
<span class="hidden md:inline">PyNN 0.12.3 documentation</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="building_networks.html">Building networks</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Multicompartmental modelling</span>
</nav>
<div id="content" role="main">
<section id="multicompartmental-modelling">
<h1>Multicompartmental modelling<a class="headerlink" href="#multicompartmental-modelling" title="Link to this heading"><span>¶</span></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The extensions to the API for multicompartmental models are an experimental feature.
We encourage users to try them out, but at this stage we do not recommend publishing
work using these extensions without very thorough checking and validation of results.</p>
</div>
<section id="cell-types">
<h2>Cell types<a class="headerlink" href="#cell-types" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#cell-types'"><span>¶</span></a></h2>
<p>As noted in <a class="reference internal" href="neurons.html"><span class="doc">Building networks: neurons</span></a>, the “standard library” approach described above needs to be modified for morphologically and biophysically-detailed neuron models,
as the number of possible combinations of morphologies, ion-channel models and synapse models is infinite.</p>
<p>Rather than a library of standard neuron models, we have a library of standard components (ion-channel models, synapse models)
from which multi-compartment models can be composed by writing a simple class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">class</span> <span class="nc">MyNeuronModel</span><span class="p">(</span><span class="n">MultiCompartmentNeuron</span><span class="p">):</span>
</span><span id="line-2">    <span class="n">ion_channels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-3">        <span class="s1">'pas'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">PassiveLeak</span><span class="p">,</span>  <span class="c1"># standard library of ion channel models</span>
</span><span id="line-4">        <span class="s1">'na'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">NaChannel</span><span class="p">,</span>
</span><span id="line-5">        <span class="s1">'kdr'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">KdrChannel</span>
</span><span id="line-6">    <span class="p">}</span>
</span><span id="line-7">    <span class="n">post_synaptic_entities</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-8">        <span class="s1">'AMPA'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">CondExpPostSynapticResponse</span><span class="p">,</span>  <span class="c1"># standard library of synapse models</span>
</span><span id="line-9">        <span class="s1">'GABA_A'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">CondExpPostSynapticResponse</span>
</span><span id="line-10">    <span class="p">}</span>
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>here we are using ion channel and synapse models from a standard library, but we also plan to support
LEMS (NeuroML) and NineML model specifications for this.</p>
</div>
</section>
<section id="parameterization">
<h2>Parameterization<a class="headerlink" href="#parameterization" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#parameterization'"><span>¶</span></a></h2>
<p>When it come to instantiating such a cell type in order to create a population, three extensions are needed when compared
to the point-neuron case:</p>
<dl class="simple">
<dt><strong>Hierarchical parameter sets</strong></dt><dd><p>Ion channel and synapse parameters should be in a separate dictionary nested inside the main parameter dictionary.</p>
</dd>
<dt><strong>More complex parameter types</strong></dt><dd><p>For the standard library of point neurons, most of the parameters are floats, with <code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code> being the only special case.
For morphologically-detailed neurons, one of the parameters is a representation of an entire morphology, since
different neurons within a population can be expected to have different morphologies.</p>
</dd>
<dt><strong>Spatial parameterization within neuron morphologies</strong></dt><dd><p>Point neurons may have parameter values that depend on the position of the neuron in space.
Neurons with axons and dendrites may have parameters whose value depends on location <em>within</em> a single neuron.</p>
</dd>
</dl>
<p>Handling of morphologies and spatial parameterization are described in the next section.</p>
</section>
<section id="morphologies">
<h2>Morphologies<a class="headerlink" href="#morphologies" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#morphologies'"><span>¶</span></a></h2>
<p>A number of existing Python tools for handling neuronal morphologies already exist
(e.g. <a class="reference external" href="https://libneuroml.readthedocs.io/en/latest/">libNeuroML</a>, <a class="reference external" href="http://briansimulator.org">Brian 2</a>, <a class="reference external" href="https://morphio.readthedocs.io/en/latest/">MorphIO</a>, <a class="reference external" href="https://github.com/btorb/btmorph_v2">btmorph</a>)
In the interest of integrating with other open-source simulation tools and standards wherever possible,
rather than reinventing the wheel (see <a class="reference internal" href="mc_aims.html"><span class="doc">Multicompartmental modelling with PyNN: design goals</span></a>), we would like to make use of these tools within PyNN,
and give users a choice of tools where there is overlap.</p>
<p>Our proposed implementation of this is to define an interface through a parent <code class="xref py py-class docutils literal notranslate"><span class="pre">Morphology</span></code>,
which can be sub-classed for the different Python representations of neuronal morphology,
e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">NeuroMLMorphology</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BrianMorphology</span></code>.</p>
<p>This standard interface for working with morphologies allows us to define tools for spatial parameterization,
and, more generally, for specifying points and regions within the neurites, in a format-independent way.</p>
<p>The general principle is to present an interface to the user that treats the neuron as a continuous
tree structure, and hides details of the spatial discretization, while mapping points and regions defined by the user
to the particular section/segment used internally by the simulator.</p>
<section id="selecting-points-and-regions">
<h3>Selecting points and regions<a class="headerlink" href="#selecting-points-and-regions" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#selecting-points-and-regions'"><span>¶</span></a></h3>
<p>For simple morphologies, each section/segment/compartment of the neuron can be given an explicit label.
Where we wish to distinguish a point <em>within</em> a section, we can add a <cite>fraction_along</cite> parameter.
By default, a label is taken to refer to the centre of a section.</p>
<p>Thus, for example, if we specify a two-compartment neuron using NeuroML:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="kn">from</span> <span class="nn">neuroml</span> <span class="kn">import</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">Point3DWithDiam</span> <span class="k">as</span> <span class="n">P</span>
</span><span id="line-2"><span class="kn">from</span> <span class="nn">pyNN.morphology</span> <span class="kn">import</span> <span class="n">NeuroMLMorphology</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">soma</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="n">proximal</span><span class="o">=</span><span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="mf">18.8</span><span class="p">),</span>
</span><span id="line-5">               <span class="n">distal</span><span class="o">=</span><span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">18.8</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="mf">18.8</span><span class="p">),</span>
</span><span id="line-6">               <span class="n">name</span><span class="o">=</span><span class="s2">"soma"</span><span class="p">)</span>
</span><span id="line-7"><span class="n">dend</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="n">proximal</span><span class="o">=</span><span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
</span><span id="line-8">               <span class="n">distal</span><span class="o">=</span><span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="mi">500</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
</span><span id="line-9">               <span class="n">name</span><span class="o">=</span><span class="s2">"dendrite"</span><span class="p">,</span>
</span><span id="line-10">               <span class="n">parent</span><span class="o">=</span><span class="n">soma</span><span class="p">)</span>
</span><span id="line-11">
</span><span id="line-12"><span class="n">cell_type</span> <span class="o">=</span> <span class="n">cell_class</span><span class="p">(</span><span class="n">morphology</span><span class="o">=</span><span class="n">NeuroMLMorphology</span><span class="p">(</span><span class="n">segments</span><span class="o">=</span><span class="p">(</span><span class="n">soma</span><span class="p">,</span> <span class="n">dend</span><span class="p">)),</span>
</span><span id="line-13">                       <span class="o">...</span><span class="n">other</span> <span class="n">parameters</span><span class="o">...</span><span class="p">)</span>
</span><span id="line-14"><span class="n">cells</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cell_type</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>Then we can, for example, specify where to inject a current using the segment labels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">step_current</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DCSource</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">150.0</span><span class="p">)</span>
</span><span id="line-2"><span class="n">step_current</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">location</span><span class="o">=</span><span class="s2">"soma"</span><span class="p">)</span>
</span><span id="line-3"><span class="n">step_current</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">location</span><span class="o">=</span><span class="s2">"dendrite"</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>or, similarly, where to record the membrane voltage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">cells</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s1">'v'</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="p">[</span><span class="s1">'soma'</span><span class="p">,</span> <span class="s1">'dendrite'</span><span class="p">])</span>
</span></code></pre></div>
</div>
<p>For detailed morphologies it is less easy/useful to address/label specific sections,
with the exception of the soma and perhaps the axon initial segment.
We create such a morphology using, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="kn">from</span> <span class="nn">pyNN.morphology</span> <span class="kn">import</span> <span class="n">load_morphology</span>
</span><span id="line-2">
</span><span id="line-3"><span class="n">pyr_morph</span> <span class="o">=</span> <span class="n">load_morphology</span><span class="p">(</span><span class="s2">"oi15rpy4-1.CNG.swc"</span><span class="p">)</span>
</span><span id="line-4">
</span><span id="line-5"><span class="k">class</span> <span class="nc">PyramidalCell</span><span class="p">(</span><span class="n">MultiCompartmentNeuron</span><span class="p">):</span>
</span><span id="line-6">    <span class="n">ion_channels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-7">        <span class="s1">'pas'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">PassiveLeak</span><span class="p">,</span>
</span><span id="line-8">        <span class="s1">'na'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">NaChannel</span><span class="p">,</span>
</span><span id="line-9">        <span class="s1">'kdr'</span><span class="p">:</span> <span class="n">sim</span><span class="o">.</span><span class="n">KdrChannel</span>
</span><span id="line-10">    <span class="p">}</span>
</span><span id="line-11">    <span class="o">...</span>
</span><span id="line-12">
</span><span id="line-13"><span class="n">pyramidal_cell_type</span> <span class="o">=</span> <span class="n">PyramidalCell</span><span class="p">(</span><span class="n">morphology</span><span class="o">=</span><span class="n">pyr_morph</span><span class="p">,</span>
</span><span id="line-14">                                    <span class="o">...</span><span class="n">other</span> <span class="n">parameters</span><span class="o">...</span><span class="p">)</span>
</span><span id="line-15"><span class="n">pyramidal_cells</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">pyramidal_cell_type</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>We can select regions of the axonal and/or dendritic trees using a morphology filter.
At present, the available filters are <code class="xref py py-class docutils literal notranslate"><span class="pre">soma</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">apical_dendrites</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">basal_dendrites</span></code>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">dendrites</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">axon</span></code>, and <code class="xref py py-class docutils literal notranslate"><span class="pre">all</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>identifying apical and basal dendrites depends on the morphology description file providing these labels.
This is the case for SWC files, and it is also supported by NeuroML.</p>
</div>
<p>Within these regions, we can specify parameters whose values depend on the position within the region,
for example, distance along the dendrites from the soma:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">kdr_conductance_density_apical</span> <span class="o">=</span> <span class="n">by_distance</span><span class="p">(</span><span class="n">apical_dendrites</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="mf">200.0</span><span class="p">)</span>
</span><span id="line-2"><span class="n">kdr_conductance_density_basal</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">basal_dendrites</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>To specify specific points within a region (for injecting current, placing synapses or recording state variables)
we specify a “location generator”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">locations</span> <span class="o">=</span> <span class="n">at_distances</span><span class="p">(</span><span class="n">apical_dendrites</span><span class="p">(),</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">])</span>  <span class="c1"># distances in µm</span>
</span></code></pre></div>
</div>
<p>Note that this may specify more than five points, due to branching
(i.e. there will be a point on each branch at 100 µm from the soma);
equally, some branches may be shorter than 250 µm and so no point will be generated for that branch.</p>
<p>In addition to <code class="xref py py-class docutils literal notranslate"><span class="pre">at_distances</span></code>, PyNN currently provides <code class="xref py py-class docutils literal notranslate"><span class="pre">centre</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">random_placement</span></code>;
points can also be defined using labels provided in the morphology definition.
Further location generator methods are planned.</p>
</section>
</section>
<section id="projections">
<h2>Projections<a class="headerlink" href="#projections" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#projections'"><span>¶</span></a></h2>
<p>In making synaptic connections onto neurons with detailed morphologies,
we have to consider not only which post-synaptic neuron to connect to and which synapse <em>type</em> to use,
but also in which location within the morphology the synapse should be.</p>
<p>There are two possible strategies when placing the post-synaptic component of synapses on neurons:</p>
<ol class="arabic simple">
<li><p>place the post-synaptic mechanisms when creating the population (parameterized in the cell type),
then when making connections select from this pre-existing list;</p></li>
<li><p>place the post-synaptic mechanisms at the moment of creating connections.</p></li>
</ol>
<p>Both strategies are in fairly widespread use, so it would be worthwhile to support both approaches in PyNN.</p>
<p>For Strategy 1, we specify the synaptic density when creating the cell type,
as seen in the “pyramidal_cell” example above.
It should also be possible to specify the placement of individual synapses in labelled sections,
in the simple, few-compartment case (todo).</p>
<p>For Strategy 2, post-synaptic parameters are specified in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Connector</span></code> class, see next section.</p>
<p>In making synaptic connections <em>from</em> neurons with detailed morphologies,
we need to consider the location of the source of the action potential.
Where the axon is represented explicitly, this location could be any point in the axon (terminal section or en-passant).
Where the axon is not represented explicitly or is truncated, this location will be the soma, action initial segment,
or terminal point of the truncation.
In this case the synaptic delay should include a distance-dependent component, where the distance could be
as-the-crow-flies, or the path length along the original axon (before truncation).
In both cases, this is specified using the <cite>source</cite> argument of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Projection</span></code> constructor.</p>
</section>
<section id="connectors">
<h2>Connectors<a class="headerlink" href="#connectors" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#connectors'"><span>¶</span></a></h2>
<p>As noted above, for a given type of synapse, we have to consider both which post-synaptic neuron to connect to
and in which location within the morphology the synapse should be.</p>
<p>In principle, these two choices could be independent, or the choice of location could depend on which post-synaptic
neuron was chosen.</p>
<p>To support the second, more general case, we propose that the PyNN <code class="xref py py-class docutils literal notranslate"><span class="pre">Connector</span></code> classes should implement
the algorithms for both choices in a single class. The first case, of independent choices, is likely to be fairly
common however, so we also propose to extend the standard connectors from earlier versions of PyNN with a
<cite>location_selector</cite> argument, so for example we might create a projection with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">sim</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">pyramidal_cells</span><span class="p">,</span>
</span><span id="line-2">               <span class="n">connector</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(</span><span class="n">location_selector</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="n">apical_dendrites</span><span class="p">())),</span>
</span><span id="line-3">               <span class="n">synapse_type</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
</span><span id="line-4">               <span class="n">receptor_type</span><span class="o">=</span><span class="s2">"AMPA"</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>This will connect all inputs to all pyramidal cells, selecting one synapse location at random from the apical dendrites
(this random location would be different for each neuron in the pyramidal cell population).</p>
<p>If Strategy 1 (as described above) is being used,
the random sample is over those post-synaptic mechanisms already placed in the apical dendrites.</p>
<p>If Strategy 2 is being used, the random sample is over all possible locations in the apical dendrites,
and the post-synaptic mechanism is inserted at the same time as the connection is created.
In this scenario, it should be possible to set post-synaptic model and parameters at the same time, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">sim</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">pyramidal_cells</span><span class="p">,</span>
</span><span id="line-2">           <span class="n">connector</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">AllToAllConnector</span><span class="p">(</span><span class="n">location_selector</span><span class="o">=</span><span class="n">sample</span><span class="p">(</span><span class="n">apical_dendrites</span><span class="p">())),</span>
</span><span id="line-3">           <span class="n">synapse_type</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">StaticSynapse</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
</span><span id="line-4">           <span class="n">receptor_type</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">CondExpPostSynapticResponse</span><span class="p">(</span><span class="n">tau_syn</span><span class="o">=</span><span class="n">RandomDistribution</span><span class="p">(</span><span class="s1">'normal'</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))))</span>
</span></code></pre></div>
</div>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#cell-types'" class="reference internal" href="#cell-types">Cell types</a></li>
<li><a :data-current="activeSection === '#parameterization'" class="reference internal" href="#parameterization">Parameterization</a></li>
<li><a :data-current="activeSection === '#morphologies'" class="reference internal" href="#morphologies">Morphologies</a><ul>
<li><a :data-current="activeSection === '#selecting-points-and-regions'" class="reference internal" href="#selecting-points-and-regions">Selecting points and regions</a></li>
</ul>
</li>
<li><a :data-current="activeSection === '#projections'" class="reference internal" href="#projections">Projections</a></li>
<li><a :data-current="activeSection === '#connectors'" class="reference internal" href="#connectors">Connectors</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2006-2024, the PyNN community Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 8.2.3</a></p>
</div>
</div>
</footer>
</div>
<script src="_static/documentation_options.js?v=56343b9b"></script>
<script src="_static/doctools.js?v=9bcbadda"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="_static/theme.js?v=073f68d9"></script>
</body>
</html>